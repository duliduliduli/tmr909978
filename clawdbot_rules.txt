CLAWDBOT_RULES.md — Tumaro Agent Operating System (v1)This file is the binding contract for Clawdbot when working in the Tumaro repo.If any instruction conflicts with this file, STOP and ask.---0) MissionBuild Tumaro: a privacy-first, map-based booking platform for mobile services, starting with mobile detailers.Tumaro is a two-sided product with hard separation:Customer side: discovery → booking → appointments → wallet/coins → account → support.Detailer side: business ops → services → availability → promotions/coins → booking ops → day plan/route → earnings → messaging → portfolio → settings.Your job is to ship real production-grade behavior, not demos.---1) Non-Negotiable Rules (Hard Guardrails)1.1 No random changes❌ No “while I’m here” refactors.❌ No “cleanup” passes.❌ No redesigning architecture unless explicitly requested.1.2 Dependency lockdown❌ No new dependencies.❌ No upgrades (Next.js, React, Prisma, Mapbox libs, Tailwind, etc).✅ If a dependency change is required, STOP and request approval with:why it’s neededwhich packagesrisk + rollback1.3 Small diffs only (blast radius)Max files changed per task: 3Max new files per task: 2If more is needed, STOP and request approval listing exact files.1.4 No destructive operationsForbidden unless explicitly approved:`rm -rf`, deleting directoriesmass renames or moving many files“format entire repo”changing lockfilesremoving env vars or secrets-related content1.5 Role separation ruleIf a feature affects both customer + detailer:Implement in two tasks, not one.Task A: customer flowTask B: detailer flowDo not blend role logic unless explicitly requested.---2) Allowed Scope (Where Clawdbot Can Work)✅ Allowed paths:`src/app/**``src/components/**``src/lib/**``prisma/**``scripts/**`❌ Disallowed paths:`.git/**`, `.github/**`deployment configs`package-lock.json`, `pnpm-lock.yaml`, `yarn.lock``.env*` files and secrets storageanything not listed as allowedIf you need to touch something outside allowed scope, STOP and ask.---3) Definition of Done (Every Task Must Meet)You do not “finish” a task unless these pass:3.1 Code quality gates`npm run type-check` passes`npm run lint` passes3.2 Runtime gates`npm run dev` boots with no runtime errorsRequired routes load without 404s:`/customer/map``/customer/appointments``/detailer/dashboard``/detailer/appointments``/detailer/map`3.3 UX truthIf the task is UI-related, it must be:visibleclickabletestable with stepsNo hidden “looks good in code” work.---4) Output Format (How Clawdbot Must Respond)Every response must include, in this exact order:Plan (max 8 bullets)Files to change (max 3)Minimal diff (unified diff style)Verification commandsExpected results (what Andrew should see)Rollback stepsNext recommended task (one task only)Then STOP.---5) Tumaro Product Spec (Source of Truth)Clawdbot must obey `TUMARO_SPEC.md` as the product truth.If this repo does not contain `TUMARO_SPEC.md`, Clawdbot’s FIRST TASK is:Create `TUMARO_SPEC.md` with the current agreed scope and route list.Keep it concise and explicit.Do not invent features not stated by Andrew.If instructions conflict, STOP and ask.---6) Tumaro High-Level Feature Set (Authoritative)6.1 Customer features (must remain simple + premium feel)Map discoverySnap/center to customer locationShow providers (detailers) on mapClick provider → preview card → provider profileBookingSelect service(s)Choose time/dateConfirm locationConfirm pricePay (Stripe later, but architecture supports it)Appointments tabUpcoming appointmentsPast appointments (historical)Status and detailsWallet / coinsHolds coins from businessesRedeem discounts based on rules set by businessAccountProfile, notifications, saved locations (later)ReviewsOnly after completed bookings6.2 Detailer features (business heavy)DashboardToday’s jobs count, revenue estimate, statusServicesCRUD: name, price, duration, add-onsAvailabilityWorking hours + time off + capacity logic (later)Bookings opsAccept/declineStart / completeCancel / no-show (with strikes)Day planGenerates a schedule + route order from confirmed appointmentsMorning briefing + expected earningsCoins & promotionsCreate coinConfigure earning rate + redemption rulesPromotions/boosts parametersPortfolioPhotos for profileMessagingBusiness ↔ client messaging tied to a booking“Mass message” is later (high risk; requires compliance)FinancesEarnings tracking, payouts (later)---7) Technical Constraints (Locked Stack)7.1 Webapp stack (locked)Next.js App Router + TypeScriptTailwind + shadcn/uiPrisma + PostgresMapbox (Mapbox GL / react-map-gl)Stripe (later / when enabled)7.2 Map requirements (strict)Use Mapbox, not MapLibre.No raster OSM tiles in production map.Must render provider points using GPU layers:GeoJSON sourcecircle/symbol layersclustering if neededMust provide custom UI controls:Zoom in/outCenter on meMust support provider location privacy:obfuscation bubble option---8) Data Model Rules (Prisma discipline)Do not change Prisma schema unless:the task is explicitly “schema task”you provide a migration planyou list impacted code pathsEvery schema change must include:updated Prisma typesupdated API route validation (zod)at least one smoke test path---9) API / State Rules (Prevent spaghetti)9.1 Where logic goesUI components: minimal logicBusiness logic: `src/lib/**`API routes: validate inputs, call lib, return typed outputs9.2 ValidationUse zod for request validationNever trust client input9.3 Client stateZustand only for:UI preferencescached location (non-sensitive)view stateBookings + provider data should be server-sourced when possible.---10) Security / Privacy RulesNever log tokens, secrets, or full addresses.Avoid storing precise customer addresses in client state.Provider “privacy bubble” must be supported.Any messaging feature must be scoped and rate-limited later (don’t implement mass SMS casually).---11) Clawdbot Horizon Goals (Keep the future clear)These are the guiding goals that prevent wasted work and keep Tumaro scalable.Goal A — Ship the “Core Loop” firstCore loop = discover → book → appointment → complete → review → repeatEverything else is secondary until this loop feels flawless.Goal B — Two-sided separation stays cleanCustomer stays simple and fast.Detailer stays powerful and operational.Never leak detailer admin tools into customer UI.Goal C — Map reliability is non-negotiableIf the map fails to load or center reliably, nothing else matters.Map must be:stablefaststylizedclick-responsiveGoal D — Booking system must be deterministicNo double bookingsClear state machineAudit trailClear cancellation rulesGoal E — Build for 10k users without premature overengineeringTo scale to 5k–10k users:cluster provider pointscache provider GeoJSONkeep map layers GPU-basedavoid DOM marker spampaginate heavy listsBut do NOT add infra complexity without proof.Goal F — “Enterprise feel” = consistency + predictabilityconsistent componentsconsistent spacing + typographyconsistent transitionsno broken routesno “temporary” hacks that become permanentGoal G — Every sprint ends with a demonstrable user-visible upgradeIf the task doesn’t change what a user can do/see, it’s probably a distraction.---12) Sprint Order (Approved Roadmap)Sprint 0: Routing + shellsroute groups stablenav/tabs correctappointments tab presentSprint 1: Auth + rolescustomer vs detailer accountspermissions enforcedSprint 2: Mapbox map (correct implementation)snap to usercustom controlsGPU provider layersprovider card clickSprint 3: Booking v1create bookingstatus transitionsappointments list (upcoming/past)Sprint 4: Detailer day plan + routeroute polyline + stop listmorning briefing summarySprint 5: Messaging + portfolio + reviewsbooking-tied messagingportfolio upload/storage planpost-completion review---13) Task Template (Use This Every Time)TASK NAME:GOAL:SCOPE (allowed files):DO NOT:CONTEXT (snippets/tree):ACCEPTANCE TESTS:DELIVERABLE:STOP AFTER DONE.---14) First Task Recommendation (If Andrew says “go”)Start with Mapbox map reliability + controls.Because the map is the face of Tumaro and unblocks booking and routing.END.